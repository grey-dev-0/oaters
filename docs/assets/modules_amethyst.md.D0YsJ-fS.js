import{_ as a,c as i,o as t,a5 as e}from"./chunks/framework.MXlVYeMd.js";const c=JSON.parse('{"title":"Amethyst Module","description":"","frontmatter":{},"headers":[],"relativePath":"modules/amethyst.md","filePath":"modules/amethyst.md"}'),n={name:"modules/amethyst.md"};function l(r,s,h,p,o,k){return t(),i("div",null,s[0]||(s[0]=[e(`<h1 id="amethyst-module" tabindex="-1">Amethyst Module <a class="header-anchor" href="#amethyst-module" aria-label="Permalink to &quot;Amethyst Module&quot;">​</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p><strong>Amethyst</strong> is the shopping cart and e-commerce module of the OATERS ERP system. It provides essential functionality for managing customer shopping carts, handling product selection, and tracking cart contents. Amethyst integrates seamlessly with the Article module for product management and the Sapphire module for user authentication, enabling a complete e-commerce experience.</p><h2 id="business-functionality" tabindex="-1">Business Functionality <a class="header-anchor" href="#business-functionality" aria-label="Permalink to &quot;Business Functionality&quot;">​</a></h2><h3 id="core-features" tabindex="-1">Core Features <a class="header-anchor" href="#core-features" aria-label="Permalink to &quot;Core Features&quot;">​</a></h3><h4 id="_1-shopping-cart-management" tabindex="-1">1. Shopping Cart Management <a class="header-anchor" href="#_1-shopping-cart-management" aria-label="Permalink to &quot;1. Shopping Cart Management&quot;">​</a></h4><ul><li><strong>User Carts</strong>: Create and maintain individual shopping carts for authenticated users</li><li><strong>Guest Carts</strong>: Support for anonymous shopping via token-based cart identification</li><li><strong>Cart Persistence</strong>: Store cart items persistently with user or token association</li><li><strong>Multiple Cart Support</strong>: Users can maintain separate shopping sessions via tokens</li></ul><h4 id="_2-product-selection-management" tabindex="-1">2. Product Selection &amp; Management <a class="header-anchor" href="#_2-product-selection-management" aria-label="Permalink to &quot;2. Product Selection &amp; Management&quot;">​</a></h4><ul><li><strong>Add Products</strong>: Select and add articles to shopping carts</li><li><strong>Quantity Tracking</strong>: Manage product quantities with support for various measurement units</li><li><strong>Item Removal</strong>: Remove individual items or entire articles from cart</li><li><strong>Cart Updates</strong>: Modify quantities and product selections</li></ul><h4 id="_3-cart-organization" tabindex="-1">3. Cart Organization <a class="header-anchor" href="#_3-cart-organization" aria-label="Permalink to &quot;3. Cart Organization&quot;">​</a></h4><ul><li><strong>Cart Items</strong>: Detailed line items showing product, quantity, and unit</li><li><strong>Unit Support</strong>: Handle various measurement units (kg, liters, pieces, etc.)</li><li><strong>Item Association</strong>: Clear linking between cart items and articles</li></ul><h2 id="technical-architecture" tabindex="-1">Technical Architecture <a class="header-anchor" href="#technical-architecture" aria-label="Permalink to &quot;Technical Architecture&quot;">​</a></h2><h3 id="technology-stack" tabindex="-1">Technology Stack <a class="header-anchor" href="#technology-stack" aria-label="Permalink to &quot;Technology Stack&quot;">​</a></h3><ul><li><strong>Framework</strong>: Laravel 10+</li><li><strong>Module System</strong>: nwidart/laravel-modules (^10.0)</li><li><strong>Database</strong>: MySQL/PostgreSQL (tenant-specific)</li><li><strong>Authentication</strong>: Integrated with Sapphire module</li><li><strong>Multi-tenancy</strong>: Tenant-scoped data via Sapphire module</li></ul><h2 id="database-schema" tabindex="-1">Database Schema <a class="header-anchor" href="#database-schema" aria-label="Permalink to &quot;Database Schema&quot;">​</a></h2><h3 id="core-models" tabindex="-1">Core Models <a class="header-anchor" href="#core-models" aria-label="Permalink to &quot;Core Models&quot;">​</a></h3><p><strong>Cart Model</strong> (<code>Cart.php</code>)</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Shopping carts for users and guests</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Table: a_carts</span></span></code></pre></div><p>Schema:</p><ul><li>id: Primary key (increments)</li><li>user_id: Foreign key to users (nullable, unique - one cart per user)</li><li>token: Guest cart identifier (40 chars, nullable, unique)</li><li>created_at, updated_at: Timestamps</li></ul><p>Features:</p><ul><li>User-based carts: Authenticated users have unique carts linked via user_id</li><li>Guest carts: Anonymous users identified via token for cart persistence</li><li>Either user_id or token can be set, but at least one must exist</li></ul><p>Relationships:</p><ul><li><code>user()</code>: belongsTo(User) from Sapphire module</li><li><code>items()</code>: hasMany(CartArticle) - cart contents</li><li><code>articles()</code>: belongsToMany(Article) via CartArticle</li></ul><p><strong>CartArticle Model</strong> (<code>CartArticle.php</code>)</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Individual items in a shopping cart</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Table: a_cart_articles</span></span></code></pre></div><p>Schema:</p><ul><li>cart_id: Part of composite primary key</li><li>article_id: Part of composite primary key (foreign key to articles)</li><li>quantity: Item quantity (float)</li><li>quantity_unit: Unit of measurement (10 chars - kg, l, pieces, etc.)</li></ul><p>Relationships:</p><ul><li><code>cart()</code>: belongsTo(Cart)</li><li><code>article()</code>: belongsTo(Article) from Article module</li></ul><h2 id="directory-structure" tabindex="-1">Directory Structure <a class="header-anchor" href="#directory-structure" aria-label="Permalink to &quot;Directory Structure&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Modules/Amethyst/</span></span>
<span class="line"><span>├── App/</span></span>
<span class="line"><span>│   ├── Http/</span></span>
<span class="line"><span>│   │   └── Controllers/</span></span>
<span class="line"><span>│   │       ├── CartController.php         # Cart management</span></span>
<span class="line"><span>│   │       └── [Other e-commerce controllers]</span></span>
<span class="line"><span>│   ├── Models/                   # Eloquent models (2 models)</span></span>
<span class="line"><span>│   │   ├── Cart.php</span></span>
<span class="line"><span>│   │   └── CartArticle.php</span></span>
<span class="line"><span>│   └── Providers/</span></span>
<span class="line"><span>│       └── ModuleServiceProvider.php</span></span>
<span class="line"><span>├── Database/</span></span>
<span class="line"><span>│   ├── Factories/               # Model factories for testing</span></span>
<span class="line"><span>│   ├── migrations/              # Database migrations</span></span>
<span class="line"><span>│   │   └── 2024_04_02_102150_amethyst_base.php</span></span>
<span class="line"><span>│   └── Seeders/                # Database seeders</span></span>
<span class="line"><span>├── resources/</span></span>
<span class="line"><span>│   ├── views/                  # Blade templates</span></span>
<span class="line"><span>│   │   └── cart/               # Cart display templates</span></span>
<span class="line"><span>│   └── lang/                   # Translations</span></span>
<span class="line"><span>│       └── en/</span></span>
<span class="line"><span>├── routes/</span></span>
<span class="line"><span>│   ├── web.php                 # Web routes</span></span>
<span class="line"><span>│   └── api.php                 # API routes (cart operations)</span></span>
<span class="line"><span>├── config/</span></span>
<span class="line"><span>│   └── config.php              # Module configuration</span></span>
<span class="line"><span>└── module.json                 # Module metadata</span></span></code></pre></div><h2 id="key-relationships" tabindex="-1">Key Relationships <a class="header-anchor" href="#key-relationships" aria-label="Permalink to &quot;Key Relationships&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>User (Sapphire) (1) ─────── (1) Cart</span></span>
<span class="line"><span>                            ↓</span></span>
<span class="line"><span>                        CartArticle (N)</span></span>
<span class="line"><span>                            ↓</span></span>
<span class="line"><span>                        Article (Article module)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Cart (1) ─────── (N) CartArticles</span></span>
<span class="line"><span>CartArticle (N) ─────── (1) Article</span></span></code></pre></div><h2 id="integration-with-other-modules" tabindex="-1">Integration with Other Modules <a class="header-anchor" href="#integration-with-other-modules" aria-label="Permalink to &quot;Integration with Other Modules&quot;">​</a></h2><h3 id="article-module-integration" tabindex="-1">Article Module Integration <a class="header-anchor" href="#article-module-integration" aria-label="Permalink to &quot;Article Module Integration&quot;">​</a></h3><p>Amethyst integrates with the Article module for product management:</p><ul><li>References articles in cart items</li><li>Retrieves article details for cart display</li><li>Links to article inventory and pricing</li></ul><h3 id="sapphire-module-integration" tabindex="-1">Sapphire Module Integration <a class="header-anchor" href="#sapphire-module-integration" aria-label="Permalink to &quot;Sapphire Module Integration&quot;">​</a></h3><ul><li>User authentication and authorization</li><li>User identification for cart management</li><li>Tenant-scoped cart data</li></ul><h2 id="shopping-cart-workflows" tabindex="-1">Shopping Cart Workflows <a class="header-anchor" href="#shopping-cart-workflows" aria-label="Permalink to &quot;Shopping Cart Workflows&quot;">​</a></h2><h3 id="user-cart-workflow" tabindex="-1">User Cart Workflow <a class="header-anchor" href="#user-cart-workflow" aria-label="Permalink to &quot;User Cart Workflow&quot;">​</a></h3><ol><li><strong>User Authentication</strong>: User logs in to the system</li><li><strong>Create/Retrieve Cart</strong>: System retrieves or creates user&#39;s cart</li><li><strong>Add Items</strong>: User selects articles and adds to cart with quantities</li><li><strong>Update Quantities</strong>: User can modify item quantities</li><li><strong>Remove Items</strong>: User can delete items from cart</li><li><strong>Cart Persistence</strong>: Cart data automatically saved with user</li></ol><h3 id="guest-cart-workflow" tabindex="-1">Guest Cart Workflow <a class="header-anchor" href="#guest-cart-workflow" aria-label="Permalink to &quot;Guest Cart Workflow&quot;">​</a></h3><ol><li><strong>Generate Token</strong>: Create unique token for anonymous user</li><li><strong>Identify Cart</strong>: Use token for guest cart identification</li><li><strong>Add Items</strong>: Anonymous user adds products to cart</li><li><strong>Maintain State</strong>: Cart persists via token across sessions</li><li><strong>Convert to User</strong>: Optional - guest can register and claim cart</li></ol><h2 id="usage-examples" tabindex="-1">Usage Examples <a class="header-anchor" href="#usage-examples" aria-label="Permalink to &quot;Usage Examples&quot;">​</a></h2><h3 id="retrieve-user-cart" tabindex="-1">Retrieve User Cart <a class="header-anchor" href="#retrieve-user-cart" aria-label="Permalink to &quot;Retrieve User Cart&quot;">​</a></h3><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get current user&#39;s cart</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> auth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$cart </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cart;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Access cart items</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$items </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $cart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">items;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get associated articles</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$articles </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $cart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">articles;</span></span></code></pre></div><h3 id="manage-cart-items" tabindex="-1">Manage Cart Items <a class="header-anchor" href="#manage-cart-items" aria-label="Permalink to &quot;Manage Cart Items&quot;">​</a></h3><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Add item to cart</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CartArticle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;cart_id&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $cart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;article_id&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $article</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;quantity&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;quantity_unit&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;kg&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Update quantity</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$cartItem </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CartArticle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;cart_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;article_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$cartItem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;quantity&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Remove item</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CartArticle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;cart_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $cart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;article_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $article</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h3 id="guest-cart-management" tabindex="-1">Guest Cart Management <a class="header-anchor" href="#guest-cart-management" aria-label="Permalink to &quot;Guest Cart Management&quot;">​</a></h3><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create guest cart</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Str</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">random</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">40</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$cart </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Cart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;token&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $token]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Later retrieve by token</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$cart </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Cart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;token&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $token)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">first</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h2 id="api-endpoints" tabindex="-1">API Endpoints <a class="header-anchor" href="#api-endpoints" aria-label="Permalink to &quot;API Endpoints&quot;">​</a></h2><h3 id="cart-operations" tabindex="-1">Cart Operations <a class="header-anchor" href="#cart-operations" aria-label="Permalink to &quot;Cart Operations&quot;">​</a></h3><ul><li>GET <code>/api/cart</code> - Retrieve current cart</li><li>POST <code>/api/cart/items</code> - Add item to cart</li><li>PUT <code>/api/cart/items/{id}</code> - Update cart item quantity</li><li>DELETE <code>/api/cart/items/{id}</code> - Remove item from cart</li><li>GET <code>/api/cart/summary</code> - Get cart summary (total items, etc.)</li></ul><h2 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to &quot;Best Practices&quot;">​</a></h2><h3 id="cart-management" tabindex="-1">Cart Management <a class="header-anchor" href="#cart-management" aria-label="Permalink to &quot;Cart Management&quot;">​</a></h3><ul><li>Always validate article existence before adding to cart</li><li>Check article availability before processing orders</li><li>Handle quantity units consistently across system</li><li>Consider cart cleanup for abandoned guest carts (periodic cleanup)</li></ul><h3 id="data-integrity" tabindex="-1">Data Integrity <a class="header-anchor" href="#data-integrity" aria-label="Permalink to &quot;Data Integrity&quot;">​</a></h3><ul><li>Use transactions when updating multiple cart items</li><li>Validate quantity values (positive, numeric)</li><li>Ensure unit consistency with article definitions</li></ul><h3 id="performance-optimization" tabindex="-1">Performance Optimization <a class="header-anchor" href="#performance-optimization" aria-label="Permalink to &quot;Performance Optimization&quot;">​</a></h3><ul><li>Cache cart item counts for dashboard display</li><li>Use eager loading when retrieving full cart with articles</li><li>Consider pagination for carts with many items</li></ul><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><h3 id="cart-not-appearing" tabindex="-1">Cart Not Appearing <a class="header-anchor" href="#cart-not-appearing" aria-label="Permalink to &quot;Cart Not Appearing&quot;">​</a></h3><ul><li>Verify user is authenticated (for user-based carts)</li><li>Check database for cart record existence</li><li>Confirm user_id foreign key relationship</li></ul><h3 id="items-not-showing" tabindex="-1">Items Not Showing <a class="header-anchor" href="#items-not-showing" aria-label="Permalink to &quot;Items Not Showing&quot;">​</a></h3><ul><li>Verify CartArticle records exist</li><li>Check article_id references valid articles</li><li>Ensure quantity and quantity_unit are properly set</li></ul><h3 id="guest-cart-issues" tabindex="-1">Guest Cart Issues <a class="header-anchor" href="#guest-cart-issues" aria-label="Permalink to &quot;Guest Cart Issues&quot;">​</a></h3><ul><li>Verify token is valid and stored in cookie/session</li><li>Check token uniqueness in database</li><li>Confirm token is being retrieved correctly on subsequent requests</li></ul><h2 id="codebase-integration-patterns" tabindex="-1">Codebase Integration Patterns <a class="header-anchor" href="#codebase-integration-patterns" aria-label="Permalink to &quot;Codebase Integration Patterns&quot;">​</a></h2><p>The module follows OATERS patterns:</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Module Service Provider</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Register configurations</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    $this</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mergeConfigFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__DIR__</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/../config/config.php&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;amethyst&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> boot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Load migrations</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    $this</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loadMigrationsFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__DIR__</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/../Database/migrations&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Load routes</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    $this</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loadRoutesFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__DIR__</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/../routes/web.php&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Load views</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    $this</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loadViewsFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__DIR__</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> .</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/../resources/views&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;amethyst&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Cart scopes for querying</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Cart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $userId)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;items.article&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    -&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">first</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h2 id="development-notes" tabindex="-1">Development Notes <a class="header-anchor" href="#development-notes" aria-label="Permalink to &quot;Development Notes&quot;">​</a></h2><ul><li><strong>Priority</strong>: 5</li><li><strong>Alias</strong>: amethyst</li><li><strong>Service Provider</strong>: <code>Modules\\\\Amethyst\\\\App\\\\Providers\\\\ModuleServiceProvider</code></li><li><strong>Dependencies</strong>: <ul><li><strong>Article module</strong> (for product/article references)</li><li><strong>Sapphire module</strong> (for user authentication)</li></ul></li></ul><h2 id="future-enhancements" tabindex="-1">Future Enhancements <a class="header-anchor" href="#future-enhancements" aria-label="Permalink to &quot;Future Enhancements&quot;">​</a></h2><p>Planned expansions include:</p><ol><li><strong>Saved Carts</strong>: Allow users to save multiple named carts</li><li><strong>Cart Sharing</strong>: Share carts with other users or via link</li><li><strong>Recommendations</strong>: AI-based product recommendations</li><li><strong>Wishlists</strong>: Save items for later purchase</li><li><strong>Cart Analytics</strong>: Track abandoned carts and user behavior</li><li><strong>Bulk Operations</strong>: Import/export cart contents</li><li><strong>Promotions Integration</strong>: Apply discounts and coupon codes</li><li><strong>Checkout Flow</strong>: Complete order placement from cart</li><li><strong>Cart Recovery</strong>: Automated emails for abandoned carts</li><li><strong>Mobile Optimization</strong>: PWA support for mobile shopping</li></ol>`,77)]))}const g=a(n,[["render",l]]);export{c as __pageData,g as default};
